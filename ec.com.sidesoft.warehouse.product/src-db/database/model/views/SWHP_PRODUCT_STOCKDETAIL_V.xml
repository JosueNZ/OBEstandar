<?xml version="1.0"?>
  <database name="VIEW SWHP_PRODUCT_STOCKDETAIL_V">
    <view name="SWHP_PRODUCT_STOCKDETAIL_V"><![CDATA[SELECT get_uuid() AS swhp_product_stockdetail_v_id, p.m_product_id, l.ad_client_id, l.ad_org_id, l.isactive, sd.created, sd.createdby, sd.updated, sd.updatedby, sd.qtyonhand, sd.qtyorderonhand, sd.preqtyonhand, sd.preqtyorderonhand, sd.c_uom_id, sd.m_product_uom_id, sd.m_attributesetinstance_id, sd.m_locator_id, CASE WHEN sd.qtyonhand = 0 THEN 'N' WHEN sd.qtyonhand <> 0 THEN 'Y' ELSE NULL END AS stocked, l.m_warehouse_id, sd.reservedqty, o.name, sd.allocatedqty, l.value FROM m_storage_detail sd LEFT JOIN m_locator l ON sd.m_locator_id = l.m_locator_id LEFT JOIN m_warehouse w ON l.m_warehouse_id = w.m_warehouse_id LEFT JOIN ad_org o ON w.ad_org_id = o.ad_org_id JOIN m_product p ON sd.m_product_id = p.m_product_id AND p.isactive = 'Y' WHERE w.isactive = 'Y' AND sd.qtyonhand <> 0 UNION ALL SELECT get_uuid() AS swhp_product_stockdetail_v_id, p.m_product_id, p.ad_client_id, p.ad_org_id, p.isactive, p.created, p.createdby, p.updated, p.updatedby, 0 AS qtyonhand, NULL AS qtyorderonhand, 0 AS preqtyonhand, NULL AS preqtyorderonhand, p.c_uom_id, NULL AS m_product_uom_id, CASE p.attrsetvaluetype WHEN 'D' THEN p.m_attributesetinstance_id ELSE NULL END AS m_attributesetinstance_id, ml.m_locator_id, 'N' AS stocked, NULL AS m_warehouse_id, 0 AS reservedqty, o.name, 0 AS allocatedqty, ml.value FROM m_product p LEFT JOIN swhp_wh_product wp ON p.m_product_id = wp.m_product_id LEFT JOIN m_locator ml ON wp.m_locator_id = ml.m_locator_id LEFT JOIN m_warehouse w ON ml.m_warehouse_id = w.m_warehouse_id LEFT JOIN ad_org o ON w.ad_org_id = o.ad_org_id WHERE p.isgeneric = 'N' AND (NOT (p.m_product_id IN (SELECT DISTINCT sd.m_product_id FROM m_storage_detail sd)) OR ((SELECT COALESCE(sum(sd1.qtyonhand), 0) AS "coalesce" FROM m_storage_detail sd1 WHERE sd1.m_product_id = p.m_product_id)) = 0 OR ((SELECT COALESCE(sum(sd1.qtyonhand), 0) AS "coalesce" FROM m_storage_detail sd1 WHERE sd1.m_product_id = p.m_product_id AND (sd1.m_locator_id IN (SELECT ml2.m_locator_id FROM m_locator ml2 WHERE ml2.m_warehouse_id = ml.m_warehouse_id)))) = 0) AND wp.m_locator_id IS NOT NULL]]></view>
  </database>
